    <!-- V2-3版本--><!-- 在“添加机器人”弹窗中，添加左右区域切换按钮--> 

    <!-- V2-2版本--><!-- 将左右卡片交换位置--> 

    <!-- V2-1版本--><!-- 优化细节
    加强窗口变化检测，解决卡片跳动bug--> 

    <!-- V1-5版本--><!-- 增加进度条
    倒计时进度条随着倒计时的进行，逐渐变小，当进度条为0时，则消失-->

    <!-- V1-4版本--><!-- 调整区域卡片
    单个卡片最大，两个卡片平分，三个卡片默认大小-->

    <!-- V1-3版本--><!-- 区分两个区域
    行走和测试分成了两个区域，已经分别展示了：走路和测试 -->

    <!--V1-2版本--><!-- 添加/编辑机器人弹窗，
    有行走测试和老化测试的机器人卡片，并且可以进行编辑以及删除 -->

    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>机器人生产状态监控</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- 配置Tailwind自定义主题 -->
    <script>
        tailwind.config = {
        theme: {
            extend: {
            colors: {
                primary: '#165DFF',
                success: '#00B42A',
                warning: '#FF7D00',
                danger: '#F53F3F',
                purple: '#722ED1',
                gray: {
                100: '#F2F3F5',
                200: '#E5E6EB',
                300: '#C9CDD4',
                400: '#86909C',
                500: '#4E5969',
                600: '#1D2129',
                }
            },
            fontFamily: {
                sans: ['Inter', 'system-ui', 'sans-serif'],
            },
            },
        }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
        .content-auto {
            content-visibility: auto;
        }
        .card-hover {
            @apply transition-all duration-300 hover:shadow-lg transform hover:-translate-y-0.5;
        }
        .btn-primary {
            @apply bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-all;
        }
        .btn-secondary {
            @apply bg-gray-200 text-gray-600 px-4 py-2 rounded-md hover:bg-gray-300 transition-all;
        }
        .btn-danger {
            @apply bg-danger text-white px-4 py-2 rounded-md hover:bg-danger/90 transition-all;
        }
        .status-badge {
            @apply px-3 py-1 rounded-full font-medium;
        }
        .test-type-badge {
            @apply px-6 py-2 rounded-full font-medium my-6 inline-block;
        }
        .test-section {
            @apply bg-white rounded-xl shadow-md p-6 transition-all duration-300 h-full;
        }
        .test-section-header {
            @apply mb-6 pb-3 border-b border-gray-200 flex justify-between items-center;
        }
        /* 卡片尺寸类 */
        .card-size-1 { @apply p-8; }
        .card-size-2 { @apply p-6; }
        .card-size-3 { @apply p-5; }
        .input-error { @apply border-danger focus:ring-danger focus:border-danger; }

        /* 圆形进度条样式 */
        .progress-container {
            position: relative;
            display: inline-block;
        }
        .progress-ring {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        .progress-ring-bg {
            stroke: #E5E6EB;
        }
        .progress-ring-progress {
            transition: stroke-dashoffset 0.35s;
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            width: 100%;
            text-align: center;
        }
        }
    </style>
    </head>
    <body class="bg-gray-100 min-h-screen">
    <!-- 主界面 -->
    <div id="main-view" class="container mx-auto px-4 py-8">
        <!-- 顶部区域 -->
        <div class="flex justify-between items-center mb-8">
        <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-gray-600">机器人生产状态监控</h1>
        <button id="add-robot" class="btn-primary flex items-center gap-2">
            <i class="fa fa-plus"></i>
            <span>添加机器人</span>
        </button>
        </div>

        <!-- 测试区域容器 -->
        <div id="test-sections-container" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- 测试区域将根据切换状态动态渲染 -->
        </div>
    </div>

    <!-- 详情页 (默认隐藏) -->
    <div id="detail-view" class="container mx-auto px-4 py-8 hidden">
        <div class="flex justify-between items-center mb-6">
        <button id="back-to-list" class="btn-secondary flex items-center gap-2">
            <i class="fa fa-arrow-left"></i>
            <span>返回列表</span>
        </button>
        <h2 id="detail-robot-id" class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-gray-600">K123025090020</h2>
        </div>

        <!-- 测试类型和状态显示 -->
        <div class="text-center mb-8 flex flex-col sm:flex-row justify-center items-center gap-4 flex-wrap">
        <span id="detail-test-type" class="test-type-badge bg-success text-white text-[clamp(1.5rem,3vw,2.5rem)]">行走测试</span>
        <span id="detail-status-badge" class="test-type-badge bg-gray-200 text-gray-600 text-[clamp(1.5rem,3vw,2.5rem)]">待启动</span>
        </div>

        <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-8 text-center">
        <!-- 详情页圆形进度条 -->
        <div class="flex justify-center mb-8">
            <div class="progress-container" style="width: 240px; height: 240px;">
            <svg class="progress-ring w-full h-full" viewBox="0 0 100 100">
                <circle class="progress-ring-bg" stroke-width="6" fill="transparent" r="44" cx="50" cy="50"/>
                <circle id="detail-progress-ring" class="progress-ring-progress" stroke-width="6" fill="transparent" r="44" cx="50" cy="50" stroke-dasharray="276.46" stroke-dashoffset="0"/>
            </svg>
            <div id="detail-countdown" class="progress-text text-[clamp(2.5rem,8vw,4rem)] text-success">20:00</div>
            </div>
        </div>

        <div id="detail-start-time" class="text-gray-500 text-xl mb-12">启动时间：未启动</div>

        <div class="flex flex-wrap justify-center gap-4">
            <button id="detail-edit" class="btn-secondary flex items-center gap-2">
            <i class="fa fa-pencil"></i>
            <span>编辑</span>
            </button>
            <button id="detail-start" class="btn-primary flex items-center gap-2">
            <i class="fa fa-play"></i>
            <span>开始</span>
            </button>
            <button id="detail-restart" class="btn-primary flex items-center gap-2 hidden">
            <i class="fa fa-refresh"></i>
            <span>重新开始</span>
            </button>
            <button id="detail-pause" class="bg-warning text-white px-4 py-2 rounded-md hover:bg-warning/90 transition-all flex items-center gap-2 hidden">
            <i class="fa fa-pause"></i>
            <span>暂停</span>
            </button>
            <button id="detail-reset" class="btn-secondary flex items-center gap-2">
            <i class="fa fa-refresh"></i>
            <span>重置</span>
            </button>
            <button id="detail-delete" class="btn-danger flex items-center gap-2">
            <i class="fa fa-trash"></i>
            <span>删除</span>
            </button>
        </div>
        </div>
    </div>

    <!-- 添加/编辑机器人弹窗 (默认隐藏) -->
    <div id="robot-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
        <h3 id="modal-title" class="text-xl font-bold mb-4 text-gray-600">添加机器人</h3>

        <form id="robot-form">
            <input type="hidden" id="robot-index">

            <div class="mb-4">
            <label for="robot-id" class="block text-gray-500 mb-2">机器人编号</label>
            <input type="text" id="robot-id" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" placeholder="K123025090020" required>
            </div>

            <div class="mb-4">
            <label for="robot-test-type" class="block text-gray-500 mb-2">测试类型</label>
            <select id="robot-test-type" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                <option value="walking">行走测试</option>
                <option value="aging">老化测试</option>
            </select>
            </div>

            <div class="mb-6">
            <label for="robot-duration" class="block text-gray-500 mb-2">倒计时时长 (秒)</label>
            <input type="number" id="robot-duration" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" min="1" value="1200" required>
            <p class="text-gray-400 text-sm mt-1">行走测试默认20分钟(1200秒)，老化测试默认120分钟(7200秒)</p>
            </div>

            <!-- 新增：切换测试区域位置的按钮 -->
            <div class="mb-6 pt-4 border-t border-gray-200">
            <button type="button" id="toggle-test-sections" class="w-full btn-secondary flex items-center justify-center gap-2">
                <i class="fa fa-exchange"></i>
                <span id="toggle-button-text">切换测试区域左右位置</span>
            </button>
            </div>

            <div class="flex justify-end gap-3">
            <button type="button" id="close-modal" class="btn-secondary">取消</button>
            <button type="submit" class="btn-primary">保存</button>
            </div>
        </form>
        </div>
    </div>

    <!-- 删除确认弹窗 -->
    <div id="delete-confirm-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
        <h3 class="text-xl font-bold mb-4 text-gray-600">确认删除</h3>
        <p class="text-gray-500 mb-6">您确定要删除这个机器人吗？此操作不可撤销。</p>

        <div class="flex justify-end gap-3">
            <button id="cancel-delete" class="btn-secondary">取消</button>
            <button id="confirm-delete" class="btn-danger">确认删除</button>
        </div>
        </div>
    </div>

    <!-- 编号冲突提示弹窗 -->
    <div id="duplicate-id-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md text-center">
        <div class="text-danger text-5xl mb-4">
            <i class="fa fa-exclamation-circle"></i>
        </div>
        <h3 class="text-xl font-bold mb-2 text-gray-600">编号冲突</h3>
        <p class="text-gray-500 mb-6">请核实机器编号，该编号已存在</p>
        <button id="close-duplicate-modal" class="btn-primary">确定</button>
        </div>
    </div>

    <script>
        // 机器人数据存储
        let robots = [
        { id: 'K123025090020', testType: 'walking', duration: 1200, startTime: null, remainingTime: 1200, isRunning: false },
        { id: 'K123025090021', testType: 'aging', duration: 7200, startTime: null, remainingTime: 7200, isRunning: false }
        ];

        // 测试区域位置切换状态 (true: 老化测试在左，行走测试在右; false: 行走测试在左，老化测试在右)
        let swapTestSections = false;

        // 当前选中的机器人索引
        let currentRobotIndex = null;

        // 定时器
        let timers = {};

        // DOM元素
        const mainView = document.getElementById('main-view');
        const detailView = document.getElementById('detail-view');
        const testSectionsContainer = document.getElementById('test-sections-container');
        const addRobotBtn = document.getElementById('add-robot');
        const backToListBtn = document.getElementById('back-to-list');
        const robotModal = document.getElementById('robot-modal');
        const deleteConfirmModal = document.getElementById('delete-confirm-modal');
        const duplicateIdModal = document.getElementById('duplicate-id-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const cancelDeleteBtn = document.getElementById('cancel-delete');
        const confirmDeleteBtn = document.getElementById('confirm-delete');
        const closeDuplicateModalBtn = document.getElementById('close-duplicate-modal');
        const robotForm = document.getElementById('robot-form');
        const modalTitle = document.getElementById('modal-title');
        const robotIdInput = document.getElementById('robot-id');
        const toggleTestSectionsBtn = document.getElementById('toggle-test-sections');
        const toggleButtonText = document.getElementById('toggle-button-text');

        // 详情页元素
        const detailRobotId = document.getElementById('detail-robot-id');
        const detailTestType = document.getElementById('detail-test-type');
        const detailStatusBadge = document.getElementById('detail-status-badge');
        const detailCountdown = document.getElementById('detail-countdown');
        const detailStartTime = document.getElementById('detail-start-time');
        const detailEditBtn = document.getElementById('detail-edit');
        const detailStartBtn = document.getElementById('detail-start');
        const detailRestartBtn = document.getElementById('detail-restart');
        const detailPauseBtn = document.getElementById('detail-pause');
        const detailResetBtn = document.getElementById('detail-reset');
        const detailDeleteBtn = document.getElementById('detail-delete');
        const detailProgressRing = document.getElementById('detail-progress-ring');

        // 初始化页面
        function init() {
        renderTestSections();
        updateToggleButtonText();
        setupEventListeners();
        }

        // 渲染测试区域（根据切换状态决定顺序）
        function renderTestSections() {
        // 清空容器
        testSectionsContainer.innerHTML = '';

        // 根据切换状态决定渲染顺序
        if (swapTestSections) {
            // 老化测试在左，行走测试在右
            testSectionsContainer.appendChild(createAgingTestSection());
            testSectionsContainer.appendChild(createWalkingTestSection());
        } else {
            // 行走测试在左，老化测试在右
            testSectionsContainer.appendChild(createWalkingTestSection());
            testSectionsContainer.appendChild(createAgingTestSection());
        }
        }

        // 创建行走测试区域
        function createWalkingTestSection() {
        const walkingRobots = robots.filter(robot => robot.testType === 'walking');
        const section = document.createElement('div');
        section.className = 'test-section';

        section.innerHTML = `
            <div class="test-section-header">
            <h2 class="text-2xl md:text-3xl font-bold text-success flex items-center">
                <i class="fa fa-male mr-3 text-xl md:text-2xl"></i>行走测试区
            </h2>
            </div>
            <div id="walking-robots-grid" class="grid gap-6 h-[calc(100%-6rem)]">
            <!-- 行走测试机器人卡片将动态生成 -->
            </div>
        `;

        const grid = section.querySelector('#walking-robots-grid');
        setGridLayout(grid, walkingRobots.length);

        walkingRobots.forEach((robot) => {
            const globalIndex = robots.findIndex(r => r.id === robot.id);
            const card = createRobotCard(robot, globalIndex);
            grid.appendChild(card);
        });

        return section;
        }

        // 创建老化测试区域
        function createAgingTestSection() {
        const agingRobots = robots.filter(robot => robot.testType === 'aging');
        const section = document.createElement('div');
        section.className = 'test-section';

        section.innerHTML = `
            <div class="test-section-header">
            <h2 class="text-2xl md:text-3xl font-bold text-purple flex items-center">
                <i class="fa fa-clock-o mr-3 text-xl md:text-2xl"></i>老化测试区
            </h2>
            </div>
            <div id="aging-robots-grid" class="grid gap-6 h-[calc(100%-6rem)]">
            <!-- 老化测试机器人卡片将动态生成 -->
            </div>
        `;

        const grid = section.querySelector('#aging-robots-grid');
        setGridLayout(grid, agingRobots.length);

        agingRobots.forEach((robot) => {
            const globalIndex = robots.findIndex(r => r.id === robot.id);
            const card = createRobotCard(robot, globalIndex);
            grid.appendChild(card);
        });

        return section;
        }

        // 根据卡片数量设置网格布局
        function setGridLayout(gridElement, count) {
        gridElement.classList.remove('grid-cols-1', 'grid-cols-2');

        if (count === 1) {
            gridElement.classList.add('grid-cols-1');
        } else if (count === 2) {
            gridElement.classList.add('grid-cols-1');
            if (window.innerWidth >= 1024) {
            gridElement.classList.remove('grid-cols-1');
            gridElement.classList.add('grid-cols-2');
            }
        } else {
            gridElement.classList.add('grid-cols-1', 'sm:grid-cols-2');
        }
        }

        // 创建单个机器人卡片
        function createRobotCard(robot, index) {
        const robotTypeCount = robots.filter(r => r.testType === robot.testType).length;

        const card = document.createElement('div');

        let cardClasses = 'bg-white rounded-xl shadow card-hover cursor-pointer border-l-4 ';
        cardClasses += (robot.testType === 'walking' ? 'border-success' : 'border-purple');

        if (robotTypeCount === 1) {
            cardClasses += ' card-size-1';
        } else if (robotTypeCount === 2) {
            cardClasses += ' card-size-2';
        } else {
            cardClasses += ' card-size-3';
        }

        card.className = cardClasses;
        card.dataset.index = index;
        card.dataset.robotId = robot.id;

        // 确定状态和样式
        let statusText, statusClass, countdownClass, progressColor;
        const isFinished = robot.remainingTime <= 0;

        if (!robot.isRunning && robot.startTime === null) {
            statusText = '待启动';
            statusClass = 'bg-gray-200 text-gray-600';
            countdownClass = 'text-gray-500';
            progressColor = '#C9CDD4';
        } else if (robot.isRunning) {
            statusText = '进行中';
            statusClass = robot.testType === 'walking' ? 'bg-success text-white' : 'bg-purple text-white';
            progressColor = robot.testType === 'walking' ? '#00B42A' : '#722ED1';

            if (robot.remainingTime <= 60) {
            countdownClass = 'text-warning animate-pulse';
            statusText = '即将完成';
            statusClass = 'bg-warning text-white';
            progressColor = '#FF7D00';
            } else {
            countdownClass = robot.testType === 'walking' ? 'text-success' : 'text-purple';
            }
        } else if (isFinished) {
            statusText = '已结束';
            statusClass = 'bg-primary text-white';
            countdownClass = 'text-primary';
            progressColor = '#165DFF';
        } else {
            statusText = '暂停中';
            statusClass = 'bg-warning text-white';
            countdownClass = 'text-warning';
            progressColor = '#FF7D00';
        }

        // 计算进度百分比
        const progressPercentage = isFinished ? 0 : (robot.remainingTime / robot.duration) * 100;
        const circumference = 2 * Math.PI * 44;
        const offset = circumference - (progressPercentage / 100) * circumference;

        // 根据卡片数量调整字体大小和进度条尺寸
        const timeFontSize = robotTypeCount === 1 ? 'text-2xl' :
                            (robotTypeCount === 2 ? 'text-xl' : 'text-lg');

        const idFontSize = robotTypeCount === 1 ? 'text-2xl' :
                            (robotTypeCount === 2 ? 'text-xl' : 'text-lg');

        const progressSize = robotTypeCount === 1 ? '120px' :
                            (robotTypeCount === 2 ? '100px' : '80px');

        const statusFontSize = robotTypeCount === 1 ? 'text-xl' :
                                (robotTypeCount === 2 ? 'text-lg' : 'text-base');

        // 格式化时间
        const countdownText = formatTime(robot.remainingTime);
        const startTimeText = robot.startTime ? formatDateTime(robot.startTime) : '未启动';

        // 按钮组HTML
        let buttonsHtml = '';

        if (isFinished) {
            buttonsHtml = `
            <button class="restart-btn ${robot.testType === 'walking' ? 'text-success' : 'text-purple'} hover:opacity-80" data-index="${index}">
                <i class="fa fa-refresh ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            <button class="edit-btn text-gray-500 hover:text-primary" data-index="${index}">
                <i class="fa fa-pencil ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            <button class="delete-btn text-danger hover:text-danger/80" data-index="${index}">
                <i class="fa fa-trash ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            `;
        } else if (!robot.isRunning && robot.startTime === null) {
            buttonsHtml = `
            <button class="edit-btn text-gray-500 hover:text-primary" data-index="${index}">
                <i class="fa fa-pencil ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            <button class="delete-btn text-danger hover:text-danger/80" data-index="${index}">
                <i class="fa fa-trash ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            <button class="start-btn ${robot.testType === 'walking' ? 'text-success' : 'text-purple'} hover:opacity-80" data-index="${index}">
                <i class="fa fa-play ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            `;
        } else if (robot.isRunning) {
            buttonsHtml = `
            <button class="pause-btn text-warning hover:text-warning/80" data-index="${index}">
                <i class="fa fa-pause ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            <button class="reset-btn text-gray-500 hover:text-gray-700" data-index="${index}">
                <i class="fa fa-refresh ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            `;
        } else {
            buttonsHtml = `
            <button class="start-btn ${robot.testType === 'walking' ? 'text-success' : 'text-purple'} hover:opacity-80" data-index="${index}">
                <i class="fa fa-play ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            <button class="reset-btn text-gray-500 hover:text-gray-700" data-index="${index}">
                <i class="fa fa-refresh ${robotTypeCount === 1 ? 'text-lg' : ''}"></i>
            </button>
            `;
        }

        card.innerHTML = `
            <div class="flex justify-between items-start mb-4">
            <div class="flex items-center gap-2">
                <i class="fa fa-robot ${robot.testType === 'walking' ? 'text-success' : 'text-purple'} ${robotTypeCount === 1 ? 'text-2xl' : 'text-xl'}"></i>
                <h3 class="font-bold text-gray-600 ${idFontSize}">${robot.id}</h3>
            </div>
            <span class="status-badge ${statusClass} ${statusFontSize} px-4 py-1.5">${statusText}</span>
            </div>

            <!-- 圆形进度条 -->
            <div class="flex justify-center mb-6">
            <div class="progress-container" style="width: ${progressSize}; height: ${progressSize};">
                <svg class="progress-ring w-full h-full" viewBox="0 0 100 100">
                <circle class="progress-ring-bg" stroke-width="6" fill="transparent" r="44" cx="50" cy="50"/>
                <circle class="progress-ring-progress" stroke-width="6" fill="transparent" r="44" cx="50" cy="50"
                        stroke-dasharray="${circumference}" stroke-dashoffset="${offset}"
                        stroke="${progressColor}"/>
                </svg>
                <div class="progress-text ${countdownClass} ${timeFontSize}" style="min-width: ${parseInt(progressSize) * 0.6}px;">${countdownText}</div>
            </div>
            </div>

            <div class="flex justify-between items-center ${robotTypeCount === 1 ? 'text-base' : 'text-sm'}">
            <span class="text-gray-400">开始时间：${startTimeText}</span>

            <div class="flex gap-3">
                ${buttonsHtml}
            </div>
            </div>
        `;

        // 添加点击事件
        card.addEventListener('click', (e) => {
            if (e.target.closest('button')) return;
            showDetailView(index);
        });

        // 为按钮添加事件
        if (card.querySelector('.edit-btn')) {
            card.querySelector('.edit-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            openEditModal(index);
            });
        }

        if (card.querySelector('.start-btn')) {
            card.querySelector('.start-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            startRobot(index);
            });
        }

        if (card.querySelector('.restart-btn')) {
            card.querySelector('.restart-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            resetRobot(index, true);
            });
        }

        if (card.querySelector('.pause-btn')) {
            card.querySelector('.pause-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            pauseRobot(index);
            });
        }

        if (card.querySelector('.reset-btn')) {
            card.querySelector('.reset-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            resetRobot(index);
            });
        }

        if (card.querySelector('.delete-btn')) {
            card.querySelector('.delete-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            openDeleteConfirmModal(index);
            });
        }

        return card;
        }

        // 局部更新卡片数据
        function updateRobotCard(index) {
        const robot = robots[index];
        const card = document.querySelector(`[data-robot-id="${robot.id}"]`);

        if (!card) return;

        // 只更新需要变化的部分
        const progressPercentage = robot.remainingTime <= 0 ? 0 : (robot.remainingTime / robot.duration) * 100;
        const circumference = 2 * Math.PI * 44;
        const offset = circumference - (progressPercentage / 100) * circumference;

        // 更新倒计时文本
        const countdownText = formatTime(robot.remainingTime);
        const progressText = card.querySelector('.progress-text');
        if (progressText) {
            progressText.textContent = countdownText;
        }

        // 更新进度条
        const progressRing = card.querySelector('.progress-ring-progress');
        if (progressRing) {
            progressRing.style.strokeDashoffset = offset;
        }

        // 当即将完成时更新状态样式
        if (robot.isRunning && robot.remainingTime <= 60 && robot.remainingTime > 0) {
            const statusBadge = card.querySelector('.status-badge');
            if (statusBadge) {
            statusBadge.className = 'status-badge bg-warning text-white text-xl px-4 py-1.5';
            statusBadge.textContent = '即将完成';
            }

            if (progressText) {
            progressText.className = 'progress-text text-warning animate-pulse text-2xl';
            }

            if (progressRing) {
            progressRing.style.stroke = '#FF7D00';
            }
        }

        // 倒计时结束时更新整个卡片
        if (robot.remainingTime <= 0) {
            renderTestSections();
        }
        }

        // 显示详情页
        function showDetailView(index) {
        currentRobotIndex = index;
        const robot = robots[index];

        detailRobotId.textContent = robot.id;
        updateDetailView();

        mainView.classList.add('hidden');
        detailView.classList.remove('hidden');
        }

        // 更新详情页数据
        function updateDetailView() {
        if (currentRobotIndex === null) return;

        const robot = robots[currentRobotIndex];

        // 更新测试类型显示
        const testTypeFullText = getTestTypeFullText(robot.testType);
        detailTestType.className = `test-type-badge ${robot.testType === 'walking' ? 'bg-success' : 'bg-purple'} text-white text-[clamp(1.5rem,3vw,2.5rem)]`;
        detailTestType.textContent = testTypeFullText;

        // 确定状态和样式
        let statusText, statusClass, countdownClass, progressColor;
        const typeColor = getTestTypeColor(robot.testType);
        const isFinished = robot.remainingTime <= 0;

        const isNotStarted = !robot.startTime;
        const isRunning = robot.isRunning;
        const isPaused = !robot.isRunning && robot.startTime && robot.remainingTime > 0;

        // 状态文本控制
        if (isNotStarted) {
            statusText = '待启动';
            statusClass = 'bg-gray-200 text-gray-600';
            countdownClass = 'text-gray-500';
            progressColor = '#C9CDD4';
        } else if (isRunning) {
            statusText = '进行中';
            statusClass = robot.testType === 'walking' ? 'bg-success text-white' : 'bg-purple text-white';
            progressColor = robot.testType === 'walking' ? '#00B42A' : '#722ED1';

            if (robot.remainingTime <= 60) {
            countdownClass = 'text-warning animate-pulse';
            statusText = '即将完成';
            statusClass = 'bg-warning text-white';
            progressColor = '#FF7D00';
            } else {
            countdownClass = `text-${typeColor}`;
            }
        } else if (isPaused) {
            statusText = '暂停中';
            statusClass = 'bg-warning text-white';
            countdownClass = 'text-warning';
            progressColor = '#FF7D00';
        } else { // isFinished
            statusText = '已结束';
            statusClass = 'bg-primary text-white';
            countdownClass = 'text-primary';
            progressColor = '#165DFF';
        }

        // 更新状态标签
        detailStatusBadge.className = `test-type-badge ${statusClass} text-[clamp(1.5rem,3vw,2.5rem)]`;
        detailStatusBadge.textContent = statusText;

        // 计算进度百分比和圆形进度条
        const progressPercentage = isFinished ? 0 : (robot.remainingTime / robot.duration) * 100;
        const circumference = 2 * Math.PI * 44;
        const offset = circumference - (progressPercentage / 100) * circumference;

        // 格式化时间
        const countdownText = formatTime(robot.remainingTime);
        const startTimeText = robot.startTime ? `启动时间：${formatDateTime(robot.startTime)}` : '启动时间：未启动';

        // 更新DOM
        detailCountdown.className = `progress-text ${countdownClass} text-[clamp(2.5rem,8vw,4rem)]`;
        detailCountdown.textContent = countdownText;
        detailStartTime.textContent = startTimeText;

        // 更新进度条
        detailProgressRing.style.strokeDasharray = circumference;
        detailProgressRing.style.strokeDashoffset = offset;
        detailProgressRing.style.stroke = progressColor;

        // 按钮显示控制
        const showEditDelete = isNotStarted || isFinished;
        detailEditBtn.classList.toggle('hidden', !showEditDelete);
        detailDeleteBtn.classList.toggle('hidden', !showEditDelete);

        detailStartBtn.classList.toggle('hidden', !isNotStarted && !isPaused);
        detailRestartBtn.classList.toggle('hidden', !isFinished);
        detailPauseBtn.classList.toggle('hidden', !isRunning);
        detailResetBtn.classList.toggle('hidden', isNotStarted || isFinished);

        if (isPaused) {
            detailStartBtn.innerHTML = '<i class="fa fa-play"></i><span>继续运行</span>';
        } else if (isNotStarted) {
            detailStartBtn.innerHTML = '<i class="fa fa-play"></i><span>开始</span>';
        }
        }

        // 开始机器人倒计时
        function startRobot(index) {
        const robot = robots[index];

        if (robot.remainingTime <= 0) {
            resetRobot(index, true);
            return;
        }

        robot.isRunning = true;

        if (!robot.startTime) {
            robot.startTime = new Date();
        }

        // 启动定时器
        if (timers[index]) clearInterval(timers[index]);

        timers[index] = setInterval(() => {
            robot.remainingTime--;

            // 只更新当前卡片
            updateRobotCard(index);
            if (currentRobotIndex === index) {
            updateDetailView();
            }

            // 倒计时结束
            if (robot.remainingTime <= 0) {
            robot.isRunning = false;
            clearInterval(timers[index]);
            delete timers[index];
            renderTestSections();
            if (currentRobotIndex === index) {
                updateDetailView();
            }
            }
        }, 1000);

        renderTestSections();
        if (currentRobotIndex === index) {
            updateDetailView();
        }
        }

        // 暂停机器人倒计时
        function pauseRobot(index) {
        const robot = robots[index];
        robot.isRunning = false;

        if (timers[index]) {
            clearInterval(timers[index]);
            delete timers[index];
        }

        renderTestSections();
        if (currentRobotIndex === index) {
            updateDetailView();
        }
        }

        // 重置机器人倒计时
        function resetRobot(index, startAfterReset = false) {
        const robot = robots[index];

        if (timers[index]) {
            clearInterval(timers[index]);
            delete timers[index];
        }

        robot.isRunning = false;
        robot.startTime = null;
        robot.remainingTime = robot.duration;

        renderTestSections();
        if (currentRobotIndex === index) {
            updateDetailView();
        }

        if (startAfterReset) {
            startRobot(index);
        }
        }

        // 删除机器人
        function deleteRobot(index) {
        if (timers[index]) {
            clearInterval(timers[index]);
            delete timers[index];
        }

        robots.splice(index, 1);

        if (currentRobotIndex === index) {
            mainView.classList.remove('hidden');
            detailView.classList.add('hidden');
            currentRobotIndex = null;
        } else if (currentRobotIndex > index) {
            currentRobotIndex--;
        }

        renderTestSections();
        closeDeleteConfirmModal();
        }

        // 打开添加机器人弹窗
        function openAddModal(testType = 'walking') {
        modalTitle.textContent = '添加机器人';
        document.getElementById('robot-index').value = '';

        robotIdInput.classList.remove('input-error');

        const baseNumber = 123025090020;
        const walkingCount = robots.filter(r => r.testType === 'walking').length;
        const agingCount = robots.filter(r => r.testType === 'aging').length;

        let defaultId, defaultDuration;
        if (testType === 'walking') {
            defaultId = `K${baseNumber + walkingCount}`;
            defaultDuration = 1200;
        } else {
            defaultId = `K${baseNumber + 100 + agingCount}`;
            defaultDuration = 7200;
        }

        document.getElementById('robot-id').value = defaultId;
        document.getElementById('robot-test-type').value = testType;
        document.getElementById('robot-duration').value = defaultDuration;
        robotModal.classList.remove('hidden');
        }

        // 打开编辑机器人弹窗
        function openEditModal(index) {
        const robot = robots[index];

        robotIdInput.classList.remove('input-error');

        modalTitle.textContent = '编辑机器人';
        document.getElementById('robot-index').value = index;
        document.getElementById('robot-id').value = robot.id;
        document.getElementById('robot-test-type').value = robot.testType;
        document.getElementById('robot-duration').value = robot.duration;
        robotModal.classList.remove('hidden');
        }

        // 切换测试区域位置
        function toggleTestSectionsPosition() {
        swapTestSections = !swapTestSections;
        renderTestSections();
        updateToggleButtonText();
        }

        // 更新切换按钮文本
        function updateToggleButtonText() {
        if (swapTestSections) {
            toggleButtonText.textContent = '切换为：行走测试在左，老化测试在右';
        } else {
            toggleButtonText.textContent = '切换为：老化测试在左，行走测试在右';
        }
        }

        // 打开删除确认弹窗
        function openDeleteConfirmModal(index) {
        currentRobotIndex = index;
        deleteConfirmModal.classList.remove('hidden');
        }

        // 关闭弹窗
        function closeModal() {
        robotModal.classList.add('hidden');
        robotIdInput.classList.remove('input-error');
        }

        // 关闭删除确认弹窗
        function closeDeleteConfirmModal() {
        deleteConfirmModal.classList.add('hidden');
        }

        // 关闭编号冲突弹窗
        function closeDuplicateModal() {
        duplicateIdModal.classList.add('hidden');
        robotIdInput.focus();
        }

        // 检查编号是否重复
        function isIdDuplicate(id, currentIndex) {
        return robots.some((robot, index) => {
            if (currentIndex !== '' && index === parseInt(currentIndex)) return false;
            return robot.id.trim() === id.trim();
        });
        }

        // 保存机器人数据
        function saveRobot(e) {
        e.preventDefault();

        const index = document.getElementById('robot-index').value;
        const id = document.getElementById('robot-id').value;
        const testType = document.getElementById('robot-test-type').value;
        const duration = parseInt(document.getElementById('robot-duration').value);

        if (isIdDuplicate(id, index)) {
            duplicateIdModal.classList.remove('hidden');
            robotIdInput.classList.add('input-error');
            return;
        }

        if (index) {
            robots[index].id = id;
            robots[index].testType = testType;
            robots[index].duration = duration;
            robots[index].remainingTime = duration;
        } else {
            robots.push({
            id,
            testType,
            duration,
            remainingTime: duration,
            startTime: null,
            isRunning: false
            });
        }

        renderTestSections();
        closeModal();
        }

        // 格式化时间（秒 -> MM:SS）
        function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // 格式化日期时间
        function formatDateTime(date) {
        if (!(date instanceof Date)) {
            return '';
        }

        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        const seconds = date.getSeconds().toString().padStart(2, '0');

        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        // 获取测试类型完整文本
        function getTestTypeFullText(type) {
        return type === 'walking' ? '行走测试' : '老化测试';
        }

        // 获取测试类型对应的颜色
        function getTestTypeColor(type) {
        return type === 'walking' ? 'success' : 'purple';
        }

        // 设置事件监听器
        function setupEventListeners() {
        addRobotBtn.addEventListener('click', () => openAddModal());

        backToListBtn.addEventListener('click', () => {
            mainView.classList.remove('hidden');
            detailView.classList.add('hidden');
            currentRobotIndex = null;
        });

        closeModalBtn.addEventListener('click', closeModal);

        cancelDeleteBtn.addEventListener('click', closeDeleteConfirmModal);

        confirmDeleteBtn.addEventListener('click', () => {
            if (currentRobotIndex !== null) {
            deleteRobot(currentRobotIndex);
            }
        });

        closeDuplicateModalBtn.addEventListener('click', closeDuplicateModal);

        robotForm.addEventListener('submit', saveRobot);

        // 新增：切换测试区域位置按钮事件
        toggleTestSectionsBtn.addEventListener('click', toggleTestSectionsPosition);

        detailEditBtn.addEventListener('click', () => {
            if (currentRobotIndex !== null) {
            openEditModal(currentRobotIndex);
            }
        });

        detailStartBtn.addEventListener('click', () => {
            if (currentRobotIndex !== null) {
            startRobot(currentRobotIndex);
            }
        });

        detailRestartBtn.addEventListener('click', () => {
            if (currentRobotIndex !== null) {
            resetRobot(currentRobotIndex, true);
            }
        });

        detailPauseBtn.addEventListener('click', () => {
            if (currentRobotIndex !== null) {
            pauseRobot(currentRobotIndex);
            }
        });

        detailResetBtn.addEventListener('click', () => {
            if (currentRobotIndex !== null) {
            resetRobot(currentRobotIndex);
            }
        });

        detailDeleteBtn.addEventListener('click', () => {
            if (currentRobotIndex !== null) {
            openDeleteConfirmModal(currentRobotIndex);
            }
        });

        // 点击弹窗外部关闭弹窗
        robotModal.addEventListener('click', (e) => {
            if (e.target === robotModal) {
            closeModal();
            }
        });

        deleteConfirmModal.addEventListener('click', (e) => {
            if (e.target === deleteConfirmModal) {
            closeDeleteConfirmModal();
            }
        });

        duplicateIdModal.addEventListener('click', (e) => {
            if (e.target === duplicateIdModal) {
            closeDuplicateModal();
            }
        });

        window.addEventListener('resize', renderTestSections);
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
    </body>

    </html>
